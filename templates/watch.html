{% extends "base.html" %}
{% block content %}

{% block header %}
<meta name="thumbnail" content="{{ video.thumbnail }}">
<meta name="description" content="{{ video.short_description }}">
<meta name="keywords" content="{{ video.keywords.join(",") }}">
<meta property="og:site_name" content="Invidious">
<meta property="og:url" content="{{ HOST_URL }}/watch?v={{ video.id }}">
<meta property="og:title" content="{{ video.title }}">
<meta property="og:image" content="/vi/{{ video.id }}/maxres.jpg">
<meta property="og:description" content="{{ video.short_description }}">
<meta property="og:type" content="video.other">
<meta property="og:video:url" content="{{ HOST_URL }}/embed/{{ video.id }}">
<meta property="og:video:secure_url" content="{{ HOST_URL }}/embed/{{ video.id }}">
<meta property="og:video:type" content="text/html">
<meta property="og:video:width" content="1280">
<meta property="og:video:height" content="720">
<meta name="twitter:card" content="player">
<meta name="twitter:site" content="@omarroth1">
<meta name="twitter:url" content="{{ HOST_URL }}/watch?v={{ video.id }}">
<meta name="twitter:title" content="{{ video.title }}">
<meta name="twitter:description" content="{{ video.short_description }}">
<meta name="twitter:image" content="{{ HOST_URL }}/vi/{{ video.id }}/maxres.jpg">
<meta name="twitter:player" content="{{ HOST_URL }}/embed/{{ video.id }}">
<meta name="twitter:player:width" content="1280">
<meta name="twitter:player:height" content="720">
<link rel="alternate" href="https://www.youtube.com/watch?v={{ video.id }}">
<title>{{ video.title }} - Invidious</title>

<!-- Description expansion also updates the 'Show more' button to 'Show less' so
we're going to need to do it here in order to allow for translations.
 -->
<style>
#descexpansionbutton ~ label > a::after {
    content: "{{ localize("show_more") }}"
}
#descexpansionbutton:checked ~ label > a::after {
    content: "{{ localize("show_less") }}"
}
</style>
{% endblock header %}


<script id="video_data" type="application/json">
    {
    "id": {{ video.id }},
    "genre": {% match video.genre %} {% when Some with (genre) %}{{ video.genre }}{% when None %}null{% endmatch %},
    "index": {{ video.continuation }},
    "plid": {{ plid }},
    "length_seconds": {{ video.length_seconds }},
    "play_next":  {{ !video.related_videos.is_empty() && !plid && params.continue }},
    "next_video": {{ video.related_videos.get(0).unwrap().id }},
    "youtube_comments_text": {{ localize("view_youtube_comments") }},
    "reddit_comments_text": {{ localize("view_reddit_comments") }},
    "reddit_permalink_text": {{ localize("view_more_comments_on_reddit") }},
    "comments_text": {{ localize("view_comments", x: commentCount) }},
    "hide_replies_text": {{ localize("hide_replies") }},
    "show_replies_text": {{ localize("show_replies") }},
    "params": {{ params }},
    "preferences": {{ preferences }},
    "premiere_timestamp": {{ video.premiere_timestamp }},
    "vr": {{ video.is_vr }},
    "projection_type": {{ video.projection_type  }},
    }
</script>

<div id="player-container" class="h-box">
    {% include 'common/player.html' %}
</div>
<div class="h-box">
    <h1>
        {{ video.title }}
        {% if params.listen %}
            <a title="{{localize("video_mode")}}" href="/watch?v={{ video.id }}&listen=0">
                <i class="icon ion-ios-videocam"></i>
            </a>
        {% else %}
            <a title="{{localize("audio_mode")}}" href="/watch?v={{ video.id }}&listen=1">
                <i class="icon ion-md-headset"></i>
            </a>
        {% endif %}
    </h1>
    {% if !video.is_listed %}
        <h3>
            <i class="icon ion-ios-unlock"></i> {{ localize("unlisted") }}
        </h3>
    {% endif %}
    {% match video.reason %}
    {% when Some with (reason) %}
        <h3>
            {{ reason }}
        </h3>
    {% when None %}
    {% endmatch %}
    {% match video.premiere_timestamp %}
    {% when Some with (timestamp) %}
        <h3>
            {{ localize("premieres_in_", x: timestamp) }}
        </h3>
    {% when None %}
    {% endmatch %}
    {% if video.live_now %}
        <h3>
            {{ localize("videoinfo_started_streaming_xupload_date",  x: video.premiere_timestamp) }}
        </h3>
    {% endif %}
</div>
<div class="pure-g">
    <div class="pure-u-1 pure-u-lg-1-5">
        <div class="h-box">
            <span id="watch-on-youtube">
                <a href="https://www.youtube.com/watch?v={{ video.id }}">{{ localize("videoinfo_watch_on_youtube") }}</a>
                (<a href="https://www.youtube.com/embed/{{ video.id }}">{{ localize("videoinfo_youtube_embed_link") }}</a>)
            </span>
            <p id="watch-on-another-invidious-instance">
            {% if preferences.automatic_instance_redirect%}
                <a href="/redirect?referer={{ env.get?("current_page") }}">{{ localize("switch_invidious_instance") }}</a>
            {% else %}
                <a href="https://redirect.invidious.io{{ env.request.resource }}">{{ localize("switch_invidious_instance") }}</a>
            {% endif %}
            </p>
            <p id="embed-link">
                <a href="{{ embed_link }}">{{ localize("videoinfo_invidious_embed_link") }}</a>
            </p>
            {% if user %}
                {% let playlists = user.get_playlists() %}
                {% if !playlists.empty? %}
                    <form data-onsubmit="return_false" class="pure-form pure-form-stacked" action="/playlist_ajax" method="post" target="_blank">
                        <div class="pure-control-group">
                            <label for="playlist_id">{{ localize("add_to_playlist") }}</label>
                            <select style="width:100%" name="playlist_id" id="playlist_id">
                                {% for playlist in playlists.iter() %}
                                    <option data-plid="{{ playlist.id }}" value="{{ playlist.id }}">{{  playlist.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <input type="hidden" name="csrf_token" value="{{ user.csrf_token }}">
                        <input type="hidden" name="action_add_video" value="1">
                        <input type="hidden" name="video_id" value="{{ video.id }}">
                        <button data-onclick="add_playlist_video" data-id="{{ video.id }}" type="submit" class="pure-button pure-button-primary">
                            <b>{{ localize("add_to_playlist") }}</b>
                        </button>
                    </form>
                    <script id="playlist_data" type="application/json">
                    {
                        "csrf_token": {{ user.csrf_token }}
                    }
                    </script>
                    <script src="/js/playlist_widget.js?v={{ Time.utc.to_unix_ms }}"></script>
                {% endif %}
            {% endif %}
            <p id="views"><i class="icon ion-ios-eye"></i> {{ number_with_separator(video.views) }}</p>
            <p id="likes"><i class="icon ion-ios-thumbs-up"></i> {{ number_with_separator(video.likes) }}</p>
            <p id="dislikes"></p>
            <p id="genre">{{ localize("genre") }}
            {% match video.genre_url %}
            {% when Some with (url) %}
            {% when None %}
                {% match video.genre %}
                {% when Some with (genre) %}
                    {{ genre }}
                {% when None %}
                {% endmatch %}
            {% when Some with (url) %}
                {% match video.genre %}
                {% when Some with (genre) %}
                <a href="{{ url }}">{{ genre }}</a>
                {% when None %}
                {% endmatch %}
            {% endmatch %}
            </p>
            {% match video.license %}
                {% when Some with (license) %}
                <p id="license">{{ localize("license") }}{{ license }}</p>
                {% when None %}
            {% endmatch %}
            <p id="family_friendly">{{ localize("family_friendly_") }} {{ video.is_family_friendly }}</p>
            <p id="wilson">{{ localize("wilson_score") }}{{ video.wilson_score }}</p>
            <p id="rating"></p>
            <p id="engagement">{{ localize("engagement") }}{{ video.engagement }}%</p>
            {% if video.allowed_regions.size != REGIONS.size %}
                <p id="allowed_regions">
                    {% if video.allowed_regions < REGIONS %}
                        {{ localize("whitelisted_regions") }}{{ video.allowed_regions.join(", ") }}
                    {% else %}
                        {{ localize("blacklisted_regions") }}{{ (REGIONS.to_a - video.allowed_regions).join(", ") }}
                    {% endif %}
                </p>
            {% endif %}
        </div>
    </div>
    <div class="pure-u-1 {% if video.related_videos || plid %}pure-u-lg-3-5{% else %}pure-u-md-4-5{% endif %}">
        <div class="h-box">
            <a href="/channel/{{ video.ucid }}" style="display:block;width:fit-content;width:-moz-fit-content">
                <div class="channel-profile">
                    {% if !video.author_thumbnail.empty?%}
                        <img src="/ggpht{{ URI.parse(video.author_thumbnail).request_target }}">
                    {% endif %}
                    <span id="channel-name">{{ video.author }}{% if !video.author_verified.nil? && video.author_verified %}&nbsp;<i class="icon ion ion-md-checkmark-circle"></i>{% endif %}</span>
                </div>
            </a>
            {% let sub_count_text = video.sub_count_text %}
            {% include 'common/subscribe_widget.html' %}
            <p id="published-date">
                {% if video.premiere_timestamp > Time.utc %}
                    <b>{{ localize("premieres_", x: video.premiere_timestamp) }}</b>
                {% else %}
                    <b>{{ localize("shared_", x: video.published) }}</b>
                {% endif %}
            </p>
            <div id="description-box"> 
                <!-- Description -->
                {% if video.description.size < 200 || params.extend_desc%}
                    <div id="descriptionWrapper">{{ video.description_html }}</div>
                {% else %}
                    <input id="descexpansionbutton" type="checkbox"/>
                    <div id="descriptionWrapper">{{ video.description_html }}</div>
                    <label for="descexpansionbutton">
                        <a></a>
                    </label>
                {% endif %}
            </div>
            <hr>
            <div id="comments">
                {% if nojs %}
                    {{ comment_html }}
                {% else %}
                    <noscript>
                        <a href="/watch?{{ video.id }}&nojs=1">
                            {{ localize("hi_looks_like_you_have_javascript_turned_off_click_here_to_view_comments_keep_in_mind_they_may_take_a_bit_longer_to_load") }}
                        </a>
                    </noscript>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="pure-u-1 pure-u-lg-1-5">
        {% if plid %}
            <div id="playlist" class="h-box"></div>
        {% endif %}
        <div class="h-box">
        {% if video.related_videos.is_empty() %}
            <div {% if plid %}style="display:none"{% endif %}>
                <div class="pure-control-group">
                    <label for="continue">{{ localize("preferences_continue_label") }}</label>
                    <input name="continue" id="continue" type="checkbox" {% if params.continue %}checked{% endif %}>
                </div>
                <hr>
            </div>
        {% else %}
        {% for rv in video.related_videos %}
            {% if rv.id %}
                {% include 'common/related_video.html' %}
            {% endif %}
        {% endfor%}
        {% endif %}
    </div>
</div>
<script src="/js/watch.js?v={{ ASSET_COMMIT }}"></script>
{% endblock content %}